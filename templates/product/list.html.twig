{% extends 'base.html.twig' %}

{% block title %}Products | MyShop{% endblock %}

{% block body %}

<!-- Page Header with Search -->
<div class="bg-light py-4">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-8">
        <h1 class="fw-bold mb-2">Our Products</h1>
        <p class="text-muted mb-0">{{ page_subtitle|default('Discover amazing products at great prices') }}</p>
      </div>
      <div class="col-lg-4 mt-3 mt-lg-0">
        <div class="input-group">
          <input type="text" 
                 class="form-control" 
                 placeholder="{{ search_placeholder|default('Search products...') }}" 
                 value="{{ search_query|default('') }}">
          <button class="btn btn-primary" type="button">
            <i class="bi bi-search"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container py-5">
  
  <!-- Filter & Sort Section -->
  <div class="row mb-4">
    <div class="col-md-6 mb-3">
      <h5 class="mb-3">Filter by Category</h5>
      <div class="d-flex flex-wrap gap-2">
        {% set categories = categories|default(['All', 'Mobiles', 'Laptops', 'Accessories', 'Tablets']) %}
        {% for category in categories %}
          <a href="#" 
             class="btn btn-outline-primary {{ loop.first ? 'active' : '' }}">
            {{ category }}
          </a>
        {% endfor %}
      </div>
    </div>
    <div class="col-md-6">
      <div class="d-flex justify-content-md-end">
        <div>
          <label class="form-label">Sort by:</label>
          <select class="form-select" style="width: 200px;">
            {% for option in sort_options|default(['Newest First', 'Price: Low to High', 'Price: High to Low', 'Most Popular']) %}
              <option {{ loop.first ? 'selected' : '' }}>{{ option }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Count -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <p class="mb-0 text-muted">Showing {{ products|length }} {{ products|length == 1 ? 'product' : 'products' }}</p>
    <div class="d-none d-md-block">
      <div class="btn-group" role="group">
        <button type="button" class="btn btn-outline-secondary active">
          <i class="bi bi-grid"></i>
        </button>
        <button type="button" class="btn btn-outline-secondary">
          <i class="bi bi-list"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Products Grid -->
  <div class="row">
    {% if products is empty %}
      <div class="col-12 text-center py-5">
        <i class="bi bi-box-seam display-1 text-muted mb-3"></i>
        <h4>{{ no_products_message|default('No products found') }}</h4>
        <p class="text-muted">{{ empty_state_text|default('Check back later for new products') }}</p>
      </div>
    {% endif %}
    
    {% for product in products %}
      <div class="col-md-6 col-lg-4 col-xl-3 mb-4">
        <div class="card h-100 product-card border-0 shadow-sm">
          
          <!-- Product Image -->
          <div class="position-relative">
            <a href="/product/{{ product.id|default('#') }}">
              <img src="{{ product.image ?? 'https://images.unsplash.com/photo-1556656793-08538906a9f8?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80' }}" 
                   class="card-img-top" 
                   alt="{{ product.name|default('Product') }}"
                   style="height: 200px; object-fit: cover;">
            </a>
            
            <!-- Sale Badge -->
            {% if product.discount ?? 0 %}
              <span class="badge bg-danger position-absolute top-0 start-0 m-2">
                -{{ product.discount }}%
              </span>
            {% endif %}
            
            <!-- New Badge -->
            {% if product.isNew|default(false) %}
              <span class="badge bg-success position-absolute top-0 end-0 m-2">
                New
              </span>
            {% endif %}
            
            <!-- Out of Stock Badge -->
            {% if product.stock|default(10) <= 0 %}
              <span class="badge bg-dark position-absolute top-50 start-50 translate-middle">
                Out of Stock
              </span>
            {% endif %}
            
            <!-- Wishlist Button -->
            <button class="btn btn-light btn-sm position-absolute bottom-0 end-0 m-2 rounded-circle">
              <i class="bi {{ product.isWishlisted|default(false) ? 'bi-heart-fill text-danger' : 'bi-heart' }}"></i>
            </button>
          </div>
          
          <!-- Product Details -->
          <div class="card-body d-flex flex-column">
            
            <!-- Category -->
            <div class="mb-2">
              <span class="badge bg-light text-dark small">
                {{ product.category|default('Electronics') }}
              </span>
            </div>
            
            <!-- Product Name -->
            <h6 class="card-title fw-bold">
              <a href="/product/{{ product.id|default('#') }}" class="text-dark text-decoration-none">
                {{ product.name|default('Product Name') }}
              </a>
            </h6>
            
            <!-- Description -->
            <p class="card-text text-muted small flex-grow-1">
              {{ product.description|default('Premium quality product')|slice(0, 80) }}...
            </p>
            
            <!-- Rating -->
            <div class="mb-3">
              <div class="text-warning small">
                {% set rating = product.rating|default(4) %}
                {% for i in 1..5 %}
                  <i class="bi bi-star{% if i <= rating %}-fill{% endif %}"></i>
                {% endfor %}
                <span class="text-muted ms-1 small">
                  ({{ product.reviewCount|default('45') }})
                </span>
              </div>
            </div>
            
            <!-- Price -->
            <div class="d-flex justify-content-between align-items-center mt-auto">
              <div>
                <span class="h5 text-dark fw-bold">₹{{ product.price|default('9999') }}</span>
                {% if product.originalPrice|default(0) > product.price|default(0) %}
                  <span class="text-decoration-line-through text-muted small ms-2">
                    ₹{{ product.originalPrice }}
                  </span>
                {% endif %}
              </div>
              
              <!-- Stock Indicator -->
              {% if product.stock|default(0) > 0 %}
                <small class="text-muted">
                  {% if product.stock < 10 %}
                    Only {{ product.stock }} left
                  {% endif %}
                </small>
              {% endif %}
              
              <!-- Action Buttons -->
              <div>
                <a href="/product/{{ product.id|default('#') }}" class="btn btn-primary btn-sm">
                  <i class="bi bi-eye me-1"></i>View
                </a>
              </div>
            </div>
            
          </div>
          
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if products|length > 0 %}
    <nav class="mt-5">
      <ul class="pagination justify-content-center">
        <li class="page-item {{ current_page|default(1) <= 1 ? 'disabled' : '' }}">
          <a class="page-link" href="?page={{ current_page|default(1) - 1 }}">
            <i class="bi bi-chevron-left"></i>
          </a>
        </li>
        
        {% set total_pages = total_pages|default(3) %}
        {% for page in 1..total_pages %}
          <li class="page-item {{ page == current_page|default(1) ? 'active' : '' }}">
            <a class="page-link" href="?page={{ page }}">{{ page }}</a>
          </li>
        {% endfor %}
        
        <li class="page-item {{ current_page|default(1) >= total_pages|default(3) ? 'disabled' : '' }}">
          <a class="page-link" href="?page={{ current_page|default(1) + 1 }}">
            <i class="bi bi-chevron-right"></i>
          </a>
        </li>
      </ul>
    </nav>
  {% endif %}

</div>

<style>
  /* Custom Styles */
  .product-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border-radius: 12px;
    overflow: hidden;
  }
  
  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
  }
  
  .product-card img {
    transition: transform 0.5s ease;
  }
  
  .product-card:hover img {
    transform: scale(1.05);
  }
  
  .btn-outline-primary.active {
    background-color: #0d6efd;
    color: white;
  }
  
  .page-item.active .page-link {
    background-color: #0d6efd;
    border-color: #0d6efd;
  }
  
  .page-link {
    color: #0d6efd;
    border-radius: 8px;
    margin: 0 3px;
    padding: 8px 16px;
  }
  
  .page-link:hover {
    color: #0a58ca;
    background-color: #f8f9fa;
  }
  
  /* Badge styles */
  .badge.bg-light {
    border: 1px solid #dee2e6;
  }
  
  /* Out of stock overlay */
  .product-card .bg-dark {
    opacity: 0.9;
    padding: 8px 16px;
    font-size: 0.8rem;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .product-card .card-title {
      font-size: 1rem;
    }
    
    .product-card .btn-sm {
      padding: 0.25rem 0.5rem;
      font-size: 0.8rem;
    }
    
    .product-card img {
      height: 180px !important;
    }
  }
  
  @media (max-width: 576px) {
    .product-card img {
      height: 160px !important;
    }
  }
</style>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

{% endblock %}